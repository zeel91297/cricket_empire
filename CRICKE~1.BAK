#include <stdio.h>
#include <graphics.h>
#include <conio.h>
#include <stdlib.h>
#include <dos.h>
#include <math.h>
#include <ctype.h>

int gmode = DETECT, gdriver;
int xx, yy;
int midx, midy;
int score=0,ball=0;

void border()
{
	setcolor(1);
	line(0,0,0,yy);
	line(0,0,xx,0);
	line(xx,0,xx,yy);
	line(0,yy,xx,yy);

	setcolor(4);
	settextstyle(10,HORIZ_DIR,3);
	outtextxy(35,5,"Welcome to Cricket Empire");

	char *strBall,*strScore;
	setcolor(2);
	//sprintf(strBall,"Ball: %d",ball);
	settextstyle(10,HORIZ_DIR,1);
	outtextxy(50,50,"Ball: ");
	outtextxy(150,50,itoa(ball,strBall,10));
	setcolor(13);
	//sprintf(strScore,"Run: %d",score);
	outtextxy(200,50,"Run: ");
	outtextxy(300,50,itoa(score,strScore,10));
}

void initial()
{
	border();
	setcolor(WHITE);
	line(0, midy + 100, xx, midy + 100);
	rectangle(560,215,570,250);
	rectangle(550,325,580,250);
}

void rotateRect(int left,int top,int right,int bottom)
{
    float x1, y1, x2, y2, x3, y3, x4, y4;
    float rad = 1.5 * (3.14 / 180);

/*    line(left, bottom, right, bottom);
    line(left, bottom, left, top);
    line(right, bottom, right, top);
    line(left, top, right, top);*/

    x1 = left * cos(rad) - bottom * sin(rad);
    y1 = left * sin(rad) + bottom * cos(rad);
    x2 = right * cos(rad) - bottom * sin(rad);
    y2 = right * sin(rad) + bottom * cos(rad);
    x3 = left * cos(rad) - top * sin(rad);
    y3 = left * sin(rad) + top * cos(rad);
    x4 = right * cos(rad) - top * sin(rad);
    y4 = right * sin(rad) + top * cos(rad);

    line(fabs(x1), fabs(y1), fabs(x2), fabs(y2));
    line(fabs(x1), fabs(y1), fabs(x3), fabs(y3));
    line(fabs(x3), fabs(y3), fabs(x4), fabs(y4));
    line(fabs(x2), fabs(y2), fabs(x4), fabs(y4));
}

void batRotation()
{
	border();
	setcolor(WHITE);
	line(0, midy + 100, xx, midy + 100);
	rotateRect(560,215,570,250);
	rotateRect(550,325,580,250);
	//delay(30);
}

void throwBall()
{
	float x = 1, y = 0.00000, j = .5, count = .1;
	float r = 10;
	sleep(1);
	for (int k = 0; k <= 1; k++)
	{
		for (float i = 90; i < 270; i += 10)
		{
			y = cos(((i * 22 / 7) / 180)) / j;
			if (y > 0)
				y = -y;
			x += 15;
			setcolor(14);
			setfillstyle(1, 14);
			circle(x, y * 100 + midx, r);
			floodfill(x, y * 100 +midx, 14);
			delay(100);
			setcolor(0);
			setfillstyle(1, 0);
			circle(x, y * 100 + midx, r);
			floodfill(x, y * 100 + midx, 0);
				//printf("%d %d",x,y);

		}
		j += count;
		count += .1;
	}
	//getch();
}

void wicketCode()
{
	for(int w=30;w<=530;w+=30)
	{
		initial();
		settextstyle(10,HORIZ_DIR,3);
		outtextxy(450,50,"WICKET");
		setcolor(14);
		setfillstyle(1,14);
		circle(w,300,10);
		floodfill(w, 300, 14);
		delay(100);
		cleardevice();
	}

	//delay(30);
	getch();
}

void run4()
{
	int mm=5;
	for(int m=midy-50;m>=30;m-=30)
	{
		//cleardevice();
		//initial();
		batRotation();
		//delay(100);
		setcolor(5);
		settextstyle(10,HORIZ_DIR,3);
		outtextxy(450,50,"FOUR");
		setcolor(WHITE);
		setfillstyle(1,14);
		circle(550-mm,m,10);
		floodfill(550-mm,m,15);
		mm+=5;
		if(m>=30 && m<=50)
		{
			continue;
		}
		else
		{
			delay(100);
			cleardevice();
		}
	}
	getch();
}

void run6()
{
	int mm=50;
	//batRotation();
	for(int m=midy-50;m>=30;m-=30)
	{
		//cleardevice();
		//initial();
		batRotation();
		settextstyle(10,HORIZ_DIR,3);
		outtextxy(450,50,"SIX");
		//delay(100);
		setcolor(WHITE);
		setfillstyle(1,14);
		circle(550-mm,m,10);
		floodfill(550-mm,m,15);
		mm+=50;
		if(m>=30 && m<=50)
		{
			continue;
		}
		else
		{
			delay(100);
			cleardevice();
		}
	}
	getch();
}

void run1235()
{
	/*setcolor(WHITE);
	circle(400,350,14);
	int ty=25;
	for(int t=400;t<=200;t-=50)
	{
		//initial();
		setcolor(WHITE);
		circle(t,350-ty,14);
		ty+=25;
	}
	getch();*/

	batRotation();
	setcolor(14);
	setfillstyle(1,14);
	circle(350,350,10);
	floodfill(350, 350, 14);

	delay(500);
	cleardevice();

	initial();
	setcolor(14);
	setfillstyle(1,14);
	circle(250,400,10);
	floodfill(250, 400, 14);

	delay(500);
	cleardevice();

	initial();
	setcolor(14);
	setfillstyle(1,14);
	circle(250,400,10);
	floodfill(250, 400, 14);
	getch();
}

void main()
{
	clrscr();
	initgraph(&gmode, &gdriver, "C:\\TC\\BGI");
	//	rectangle(2,2,518,427); left,top,right,bottom
	xx = getmaxx();
	yy = getmaxy();
	midx = getmaxx() / 2;
	midy = getmaxy() / 2;

	setcolor(4);
	settextstyle(10,HORIZ_DIR,3);
	outtextxy(35,5,"Welcome to Cricket Empire");

	int over,target;
	printf("\n\n \n \n\n\n\n");
	printf("\n Enter how many overs you want to play?:");
	scanf("%d",&over);
	printf("\n Enter your target score:");
	scanf("%d",&target);

	printf("%d %d",over,target);
	getch();
	//printf(" %d %d %d %d", xx, yy,midx,midy);
	//setcolor(14);
	line(0, midy + 100, xx, midy + 100);

	rectangle(560,215,570,250);
	rectangle(550,325,580,250);
	//ball

	//ball with run 1,2,3
	cleardevice();

	//outtextxy(350,350,"(350,350)");
//	outtextxy(250,400,"(250,400)");
//	outtextxy(200,450,"(200,450)");*/
	cleardevice();
	int flag=1;
	int randNo;
	int totalBall=6*over;
	while(flag)
	{
		initial();
		throwBall();
		srand(time(0));
		randNo=rand()%7;
		/*printf("\nrandom : %d ball: %d",randNo,ball);
		delay(30);*/
		cleardevice();
		//batRotation();
		switch(randNo)
		{
			case 0:
				run1235();
				score+=1;
				break;
			case 1:
				wicketCode();
				score+=0;
				flag=0;
				break;
			case 2:
				run1235();
				score+=2;
				break;
			case 3:
				run1235();
				score+=3;
				break;
			case 4:
				run4();
				score+=4;
				break;
			case 5:
				run1235();
				score+=5;
				break;
			case 6:
				run6();
				score+=6;
				break;
		}
		ball++;
		if(randNo==0 || ball==totalBall)
		{
			flag=0;
		}
		//getch();
		cleardevice();
	}
	//border
	setcolor(1);
	line(0,0,0,yy);
	line(0,0,xx,0);
	line(xx,0,xx,yy);
	line(0,yy,xx,yy);
//	printf("\n Score is : %d",score);

	setcolor(4);
	settextstyle(10,HORIZ_DIR,3);
	outtextxy(35,5,"Welcome to Cricket Empire");
	//printf("\n Score: %d,target:%d",score,target);
	if(score>=target)
	{
		//printf("\n Congratulations! You WON!!");
		setcolor(2);
		settextstyle(10,HORIZ_DIR,2);
		outtextxy(35,100,"Congratulations! You WON!!");
	}
	else
	{
		//printf("\n OOPS! You lose..");
		setcolor(15);
		settextstyle(10,HORIZ_DIR,3);
		outtextxy(35,100,"OOPS! You lose..");
	}
	setcolor(5);
	settextstyle(10,HORIZ_DIR,3);
	outtextxy(35,150,"Score is :");

	char *cricScore;
	setcolor(5);
	settextstyle(10,HORIZ_DIR,3);
	outtextxy(220,150,itoa(score,cricScore,10));
	printf("\n \n \n Target was %d",target);
	getch();

}